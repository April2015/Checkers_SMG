var gameLogic;!function(a){function b(a){var b;for(b in a)if(!a.prop)return!1;return!0}function c(a){return a.substr(0,1)}function d(a){return a.substr(1)}function e(a,b){return a.row!==b.row?!1:a.col!==b.col?!1:!0}function f(a,b){for(var c=0;c<a.length;c+=1)if(e(a[c],b))return!0;return!1}function g(b,c){return b===a.CONSTANTS.BLACK_INDEX&&c===a.CONSTANTS.BLACK||b===a.CONSTANTS.WHITE_INDEX&&c===a.CONSTANTS.WHITE?!0:!1}function h(b){var c,d,e=b.row,f=b.col;return b.hasOwnProperty("row")&&b.hasOwnProperty("col")?0>e||e>=a.CONSTANTS.ROW||0>f||f>=a.CONSTANTS.COLUMN?!1:(c=e%2===0,d=f%2===0,!c&&d||c&&!d?!0:!1):!1}function i(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(1===Math.abs(e.row-f.row)&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-1&&1===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===1&&1===Math.abs(e.col-f.col))return!0;return!1}function j(b,e,f){var g=b[e.row][e.col];if(d(g)===a.CONSTANTS.KING){if(2===Math.abs(e.row-f.row)&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.BLACK){if(e.row-f.row===-2&&2===Math.abs(e.col-f.col))return!0}else if(c(g)===a.CONSTANTS.WHITE&&e.row-f.row===2&&2===Math.abs(e.col-f.col))return!0;return!1}function k(b,c,d){return c!==a.CONSTANTS.DARK_SQUARE&&b.substr(0,1)!==c.substr(0,1)&&d===a.CONSTANTS.DARK_SQUARE}function l(b,c){return c===a.CONSTANTS.WHITE_INDEX&&0===b.row||c===a.CONSTANTS.BLACK_INDEX&&b.row===a.CONSTANTS.ROW-1?!0:!1}function m(a,b,c){var d={row:-1,col:-1};if(!h(a))throw new Error("Illegal from coordinate!!!");switch(b){case E.SIMPLE_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-1,d.col=a.col-1;break;case D.UP_RIGHT:d.row=a.row-1,d.col=a.col+1;break;case D.DOWN_LEFT:d.row=a.row+1,d.col=a.col-1;break;case D.DOWN_RIGHT:d.row=a.row+1,d.col=a.col+1;break;default:throw new Error("Illegal direction!")}break;case E.JUMP_MOVE:switch(c){case D.UP_LEFT:d.row=a.row-2,d.col=a.col-2;break;case D.UP_RIGHT:d.row=a.row-2,d.col=a.col+2;break;case D.DOWN_LEFT:d.row=a.row+2,d.col=a.col-2;break;case D.DOWN_RIGHT:d.row=a.row+2,d.col=a.col+2;break;default:throw new Error(C.ILLEGAL_MOVE)}break;default:throw new Error(C.ILLEGAL_MOVE)}if(!h(d))throw new Error(C.ILLEGAL_DELTA);return d}function n(){var a,b=[];return b.push({setTurn:{turnIndex:0}}),a=[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]],b.push({set:{key:"board",value:a}}),b}function o(b,c){var d,e,f=[];return 0===c.row?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.UP_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.UP_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function p(b,c){var d,e,f=[];return c.row===a.CONSTANTS.ROW-1?f:(c.row%2===0?(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d),c.col!==a.CONSTANTS.COLUMN-1&&(e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e))):(0!==c.col&&(d=m(c,E.SIMPLE_MOVE,D.DOWN_LEFT),b[d.row][d.col]===a.CONSTANTS.DARK_SQUARE&&f.push(d)),e=m(c,E.SIMPLE_MOVE,D.DOWN_RIGHT),b[e.row][e.col]===a.CONSTANTS.DARK_SQUARE&&f.push(e)),f)}function q(a,b){var c={row:-1,col:-1};if(!h(a)||!h(b))throw new Error("Illegal coordinate!!!");return 2===Math.abs(a.row-b.row)&&2===Math.abs(a.col-b.col)&&(c.row=(a.row+b.row)/2,c.col=(a.col+b.col)/2),c}function r(b,c){var d,e,f,g,h=[],i=c,j=b[c.row][c.col];return i.row<2?h:(i.col>1&&(f=m(c,E.JUMP_MOVE,D.UP_LEFT),d=q(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),i.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.UP_RIGHT),d=q(i,f),g=b[f.row][f.col],e=b[d.row][d.col],k(j,e,g)&&h.push(f)),h)}function s(b,c){var d,e,f,g,h=c,i=b[c.row][c.col],j=[];return h.row>a.CONSTANTS.ROW-3?j:(h.col>1&&(f=m(c,E.JUMP_MOVE,D.DOWN_LEFT),d=q(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),h.col<a.CONSTANTS.COLUMN-2&&(f=m(c,E.JUMP_MOVE,D.DOWN_RIGHT),d=q(h,f),g=b[f.row][f.col],e=b[d.row][d.col],k(i,e,g)&&j.push(f)),j)}function t(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=o(b,c),e=e.concat(f),f=p(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=o(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=p(b,c),e=e.concat(f))),e}function u(b,c,d){var e=[],f=[],h=b[c.row][c.col],i=h.substr(0,1),j=h.substr(1);return g(d,i)&&(j===a.CONSTANTS.KING?(f=r(b,c),e=e.concat(f),f=s(b,c),e=e.concat(f)):i===a.CONSTANTS.WHITE?(f=r(b,c),e=e.concat(f)):i===a.CONSTANTS.BLACK&&(f=s(b,c),e=e.concat(f))),e}function v(a,b,c){var d;return d=u(a,b,c),0===d.length&&(d=t(a,b,c)),d}function w(b,d){var e,f,g,h,i,j=[],k={row:-1,col:-1};for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN&&(c(b[h][i])===a.CONSTANTS.WHITE?e=!0:c(b[h][i])===a.CONSTANTS.BLACK&&(f=!0),e!==!0||f!==!0);i+=1);if(e&&!f)return a.CONSTANTS.WHITE;if(!e&&f)return a.CONSTANTS.BLACK;for(h=0;h<a.CONSTANTS.ROW;h+=1)for(i=0;i<a.CONSTANTS.COLUMN;i+=1)k.row=h,k.col=i,g=b[h][i],j=j.concat(d===a.CONSTANTS.BLACK_INDEX?v(b,k,1-d):v(b,k,1-d));return 0===j.length?d===a.CONSTANTS.BLACK_INDEX?a.CONSTANTS.BLACK:a.CONSTANTS.WHITE:""}function x(b,c){var d,e,f=[],g={row:-1,col:-1};for(d=0;d<a.CONSTANTS.ROW;d+=1)for(e=0;e<a.CONSTANTS.COLUMN;e+=1)g.row=d,g.col=e,f=f.concat(u(b,g,c));return f.length>0}function y(b,d,e,g){var k,m,n,o,p,r=!1,s=!1;if(!h(d)||!h(e))throw new Error(C.ILLEGAL_DELTA);if(i(b,d,e)?s=!0:j(b,d,e)&&(r=!0),s){if(x(b,g))throw new Error(C.ILLEGAL_IGNORE_MANDATORY_JUMP);if(m=t(b,d,g),!f(m,e))throw new Error(C.ILLEGAL_SIMPLE_MOVE)}else{if(!r)throw new Error(C.ILLEGAL_MOVE);if(n=u(b,d,g),!f(n,e))throw new Error(C.ILLEGAL_JUMP_MOVE)}s?(b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE):r&&(p=q(d,e),b[e.row][e.col]=b[d.row][d.col],b[d.row][d.col]=a.CONSTANTS.DARK_SQUARE,b[p.row][p.col]=a.CONSTANTS.DARK_SQUARE);var v=l(e,g);return v&&(c(b[e.row][e.col])===a.CONSTANTS.BLACK?b[e.row][e.col]=a.CONSTANTS.BLACK_KING:c(b[e.row][e.col])===a.CONSTANTS.WHITE&&(b[e.row][e.col]=a.CONSTANTS.WHITE_KING)),o=w(b,g),""!==o?k={endMatch:{endMatchScores:o===a.CONSTANTS.WHITE?[1,0]:[0,1]}}:(n=u(b,e,g),k=r&&n.length>0?v?{setTurn:{turnIndex:1-g}}:{setTurn:{turnIndex:g}}:{setTurn:{turnIndex:1-g}}),[k,{set:{key:"board",value:b}},{set:{key:"fromDelta",value:d}},{set:{key:"toDelta",value:e}}]}function z(a){var c,d,e,f,g=a.stateBeforeMove,h=a.turnIndexBeforeMove,i=a.move;if(b(g))return angular.equals(i,n());try{if(4!==i.length)throw new Error("Illegal Move: move length is not 4");if(c=g.board,d=i[2].set.value,e=i[3].set.value,f=y(c,d,e,h),angular.equals(i,f))return!0}catch(j){return!0}return!0}function A(){return[["--","BM","--","BM","--","BM","--","BM"],["BM","--","BM","--","BM","--","BM","--"],["--","BM","--","BM","--","BM","--","BM"],["DS","--","DS","--","DS","--","DS","--"],["--","DS","--","DS","--","DS","--","DS"],["WM","--","WM","--","WM","--","WM","--"],["--","WM","--","WM","--","WM","--","WM"],["WM","--","WM","--","WM","--","WM","--"]]}var B={ILLEGAL_CODE:{ILLEGAL_MOVE:"ILLEGAL_MOVE",ILLEGAL_SIMPLE_MOVE:"ILLEGAL_SIMPLE_MOVE",ILLEGAL_JUMP_MOVE:"ILLEGAL_JUMP_MOVE",ILLEGAL_DELTA:"ILLEGAL_DELTA",ILLEGAL_COLOR_CHANGED:"ILLEGAL_COLOR_CHANGED",ILLEGAL_CROWNED:"ILLEGAL_CROWNED",ILLEGAL_UNCROWNED:"ILLEGAL_UNCROWNED",ILLEGAL_IGNORE_MANDATORY_JUMP:"ILLEGAL_IGNORE_MANDATORY_JUMP",ILLEGAL_SET_TURN:"ILLEGAL_SET_TURN",ILLEGAL_END_MATCH_SCORE:"ILLEGAL_END_MATCH_SCORE",ILLEGAL_CODE:"ILLEGAL_CODE"},DIRECTION:{UP_LEFT:"UP_LEFT",UP_RIGHT:"UP_RIGHT",DOWN_LEFT:"DOWN_LEFT",DOWN_RIGHT:"DOWN_RIGHT"},MOVE_TYPE:{SIMPLE_MOVE:"SIMPLE_MOVE",JUMP_MOVE:"JUMP_MOVE"}},C=B.ILLEGAL_CODE,D=B.DIRECTION,E=B.MOVE_TYPE;a.CONSTANTS={ROW:8,COLUMN:8,LIGHT_SQUARE:"--",DARK_SQUARE:"DS",BLACK_MAN:"BM",BLACK_KING:"BK",WHITE_MAN:"WM",WHITE_KING:"WK",BLACK:"B",WHITE:"W",MAN:"M",KING:"K",WHITE_INDEX:0,BLACK_INDEX:1},a.isEmptyObj=b,a.getColor=c,a.getKind=d,a.isOwnColor=g,a.isSimpleMove=i,a.isJumpMove=j,a.getFirstMove=n,a.getJumpedDelta=q,a.getSimpleMoves=t,a.getJumpMoves=u,a.getAllPossibleMoves=v,a.getWinner=w,a.hasMandatoryJumps=x,a.createMove=y,a.isMoveOk=z,a.getInitialBoard=A}(gameLogic||(gameLogic={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){return{isMoveOk:gameLogic.isMoveOk,getFirstMove:gameLogic.getFirstMove,createMove:gameLogic.createMove,getJumpMoves:gameLogic.getJumpMoves,getSimpleMoves:gameLogic.getSimpleMoves,getAllPossibleMoves:gameLogic.getAllPossibleMoves,hasMandatoryJumps:gameLogic.hasMandatoryJumps,getJumpedDelta:gameLogic.getJumpedDelta,isOwnColor:gameLogic.isOwnColor,getWinner:gameLogic.getWinner,getColor:gameLogic.getColor,getKind:gameLogic.getKind,isEmptyObj:gameLogic.isEmptyObj,isSimpleMove:gameLogic.isSimpleMove,isJumpMove:gameLogic.isJumpMove,getInitialBoard:gameLogic.getInitialBoard,CONSTANTS:gameLogic.CONSTANTS}});var game;!function(a){function b(){console.log("Translation of 'RULES_OF_CHECKERS' is "+translate("RULES_OF_CHECKERS")),resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1),dragAndDropService.addDragListener("gameArea",q)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),w=!0,d()})}function d(){if(x){x=!1;var a=aiService.createComputerMove(E,G,{millisecondsLimit:1e3});log.info("computer move: ",a),gameService.makeMove(a)}}function e(a){if(F="playBlack"===a.playMode?!0:!1,G=a.yourPlayerIndex,E=a.stateAfterMove.board,l(E)&&0===a.yourPlayerIndex)return void j();y=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove;var b=y&&""!==a.playersInfo[a.yourPlayerIndex].playerId;x=b;var c=y&&""===a.playersInfo[a.yourPlayerIndex].playerId;l(D)||f(D.from,D.to,!1,function(){D=null}),c&&$timeout(i,500)}function f(a,b,c,d){var e=k(a.row,a.col),f=k(b.row,b.col),h=document.getElementById("img_"+a.row+"_"+a.col);switch(f-e){case z.COLUMN+1:g(h,c,"move_down_right","move_up_left");break;case z.COLUMN-1:g(h,c,"move_down_left","move_up_right");break;case-z.COLUMN+1:g(h,c,"move_up_right","move_down_left");break;case-z.COLUMN-1:g(h,c,"move_up_left","move_down_right");break;case 2*z.COLUMN+2:g(h,c,"jump_down_right","jump_up_left");break;case 2*z.COLUMN-2:g(h,c,"jump_down_left","jump_up_right");break;case-(2*z.COLUMN)+2:g(h,c,"jump_up_right","jump_down_left");break;case-(2*z.COLUMN)-2:g(h,c,"jump_up_left","jump_down_right")}c?(h.addEventListener("animationend",d,!1),h.addEventListener("webkitAnimationEnd",d,!1)):(h.removeEventListener("animationend",d,!1),h.removeEventListener("webkitAnimationEnd",d,!1),d())}function g(a,b,c,d){b?a.className+=F?" "+d:" "+c:a.className="piece"}function h(a,b){var c;try{c=gameLogic.createMove(angular.copy(E),a,b,G)}catch(d){return}y&&(y=!1,gameService.makeMove(c))}function i(){var a,b=1e3;a=aiService.createComputerMove(E,G,{millisecondsLimit:b});var c=a[a.length-2],d=a[a.length-1],e={row:c.set.value.row,col:c.set.value.col},g={row:d.set.value.row,col:d.set.value.col};D={from:e,to:g},f(e,g,!0,function(){h(e,g)})}function j(){try{var a=gameLogic.getFirstMove();gameService.makeMove(a)}catch(b){log.info(b),log.info("initialGame() failed")}}function k(a,b){return a*z.COLUMN+b}function l(a){return angular.isUndefined(a)||null===a}function m(a,b){var c=a%2===0,d=b%2===0;return!c&&d||c&&!d}function n(a){return F?{row:z.ROW-a.row-1,col:z.COLUMN-a.col-1}:a}function o(a,b){var c={row:a,col:b},d=n(c);return m(d.row,d.col)&&!l(E)&&"DS"!==E[d.row][d.col]}function p(a,b){var c={row:a,col:b},d=n(c),e="imgs/",f=".png";if(o(a,b))switch(E[d.row][d.col]){case"BM":return e+"black_man"+f;case"BK":return e+"black_cro"+f;case"WM":return e+"white_man"+f;case"WK":return e+"white_cro"+f}return e+"empty"+f}function q(a,b,c){A=document.getElementById("gameArea");var d=v(),e=Math.min(Math.max(b-A.offsetLeft,d.width/2),A.clientWidth-d.width/2),f=Math.min(Math.max(c-A.offsetTop,d.height/2),A.clientHeight-d.height/2),g={row:Math.floor(z.ROW*f/A.clientHeight),col:Math.floor(z.COLUMN*e/A.clientWidth)},i=n(g);if("touchstart"===a&&s(g.row,g.col)&&l(B))B=angular.copy(g),o(g.row,g.col)&&y&&r(i)&&(C=document.getElementById("img_"+B.row+"_"+B.col));else if("touchend"!==a||l(B))"touchmove"!==a||l(B)||t({top:f-.605*d.height,left:e-.605*d.width});else{var j={row:B.row,col:B.col},k={row:g.row,col:g.col};h(n(j),n(k)),t(u(B.row,B.col)),B=null,l(C)||(C.removeAttribute("style"),C=null)}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(B=null,C=null)}function r(a){return gameLogic.isOwnColor(G,E[a.row][a.col].substring(0,1))}function s(a,b){var c={row:a,col:b},d=n(c);if(!m(a,b)||!gameLogic.isOwnColor(G,E[d.row][d.col].substr(0,1)))return!1;var e,f=gameLogic.hasMandatoryJumps(E,G);return e=f?gameLogic.getJumpMoves(E,d,G):gameLogic.getSimpleMoves(E,d,G),e.length>0}function t(a){var b=v(),c=b.height/10,d=b.width/10,e=u(B.row,B.col);null!==C&&(C.style.left=a.left-e.left+d+"px",C.style.top=a.top-e.top+c+"px")}function u(a,b){var c=v(),d=a*c.height,e=b*c.width,f={top:d,left:e};return f}function v(){return{width:A.clientWidth/z.COLUMN,height:A.clientHeight/z.ROW}}var w=!1,x=!1,y=!1;a.isHelpModalShown=!1;var z=gameLogic.CONSTANTS,A=null,B=null,C=null,D=null,E=null,F=!1,G=null;a.init=b,a.isDarkCell=m,a.hasPiece=o,a.getPieceSrc=p}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_CHECKERS:"Rules of Checkers",RULES_SLIDE1:'Uncrowned pieces move one step diagonally forward and capture an opponent\'s piece by moving two consecutive steps in the same line, jumping over the piece on the first step. Multiple opposing pieces may be captured in a single turn provided this is done by successive jumps made by a single piece; the jumps do not need to be in the same line but may "zigzag" (change diagonal direction).',RULES_SLIDE2:"When a man reaches the kings row (the farthest row forward), it becomes a king, and acquires additional powers including the ability to move backwards (and capture backwards). As with non-king men, a king may make successive jumps in a single turn provided that each jump captures an opponent man or king.",RULES_SLIDE3:"Capturing is mandatory.",RULES_SLIDE4:"The player without pieces remaining, or who cannot move due to being blocked, loses the game.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a,b,c){return gameLogic.getKind(a)===h.MAN?gameLogic.getColor(a)===h.WHITE?1===b?7:5:c===h.ROW-2?7:5:gameLogic.getKind(a)===h.KING?10:0}function c(a,c){var d,e,f,g,i,j=0,k=[[0,4,0,4,0,4,0,4],[4,0,3,0,3,0,3,0],[0,3,0,2,0,2,0,4],[4,0,2,0,1,0,3,0],[0,3,0,1,0,2,0,4],[4,0,2,0,2,0,3,0],[0,3,0,3,0,3,0,4],[4,0,4,0,4,0,4,0]];if(d=gameLogic.getWinner(a,c),d===h.WHITE)return Number.MIN_VALUE;if(d===h.BLACK)return Number.MAX_VALUE;for(g=0;g<h.ROW;g+=1)for(i=0;i<h.COLUMN;i+=1)e=a[g][i],e!==h.LIGHT_SQUARE&&e!==h.DARK_SQUARE&&(f=b(e,g,i)*k[g][i],gameLogic.getColor(e)===h.BLACK?j+=f:j-=f);return j}function d(a,b){return-c(a[1].set.value,b)}function e(a,b){var c,d,e,f,g,i,j=[];for(c=gameLogic.hasMandatoryJumps(a,b),f=0;f<h.ROW;f+=1)for(g=0;g<h.COLUMN;g+=1)if(gameLogic.isOwnColor(b,a[f][g].substr(0,1)))for(e={row:f,col:g},d=c?gameLogic.getJumpMoves(a,e,b):gameLogic.getSimpleMoves(a,e,b),i=0;i<d.length;i+=1)j.push([e,d[i]]);return j}function f(a,b){for(var c=a[1].set.value,d=e(c,b),f=[],g=0;g<d.length;g++)f[g]=gameLogic.createMove(angular.copy(c),d[g][0],d[g][1],b);return f}function g(a,b,c){return alphaBetaService.alphaBetaDecision([null,{set:{key:"board",value:a}}],b,f,d,null,c)}var h=gameLogic.CONSTANTS;a.createComputerMove=g}(aiService||(aiService={})),angular.module("myApp").factory("aiService",function(){return{createComputerMove:aiService.createComputerMove}});
//# sourceMappingURL=everything.min.js.map